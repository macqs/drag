<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>선 긋기 연습 (터치 지원)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f0f9ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 10px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }

    #gameArea {
      display: flex;
      gap: 200px;
      position: relative;
      height: 300px;
      touch-action: none;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 40px;
    }

    .item {
      font-size: 32px;
      width: 60px;
      height: 60px;
      text-align: center;
      line-height: 60px;
      border-radius: 50%;
      background: white;
      border: 3px solid #ccc;
      touch-action: none;
    }

    .target {
      border-color: #93c5fd;
    }

    .line {
      position: absolute;
      height: 4px;
      background: black;
      transform-origin: left center;
    }

    #messageBox {
      margin-top: 20px;
      font-size: 20px;
      color: green;
      height: 24px;
    }
  </style>
</head>
<body>
  <h1>손가락으로 선 긋기 연습 🎯</h1>
  <div id="gameArea"></div>
  <div id="messageBox"></div>

  <script>
    const pairsList = [
      [
        { id: '1', icon: '🍎' },
        { id: '2', icon: '🐶' },
        { id: '3', icon: '🚗' }
      ],
      [
        { id: '4', icon: '🍌' },
        { id: '5', icon: '🐱' },
        { id: '6', icon: '🚌' }
      ]
    ];

    let currentStage = 0;
    let correctCount = 0;
    const gameArea = document.getElementById('gameArea');
    const messageBox = document.getElementById('messageBox');

    let startEl = null;
    let dragLine = null;

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function loadStage(stageIndex) {
      gameArea.innerHTML = '';
      messageBox.textContent = '';
      correctCount = 0;

      const pairs = pairsList[stageIndex % pairsList.length];
      const leftColumn = document.createElement('div');
      const rightColumn = document.createElement('div');
      leftColumn.className = 'column';
      rightColumn.className = 'column';

      const leftItems = shuffle([...pairs]);
      const rightItems = shuffle([...pairs]);

      leftItems.forEach(item => {
        const el = document.createElement('div');
        el.className = 'item';
        el.textContent = item.icon;
        el.dataset.id = item.id;
        el.addEventListener('touchstart', dragStart, { passive: false });
        el.addEventListener('mousedown', dragStart);
        leftColumn.appendChild(el);
      });

      rightItems.forEach(item => {
        const el = document.createElement('div');
        el.className = 'item target';
        el.textContent = item.icon;
        el.dataset.id = item.id;
        rightColumn.appendChild(el);
      });

      gameArea.appendChild(leftColumn);
      gameArea.appendChild(rightColumn);
    }

    function dragStart(e) {
      e.preventDefault();
      startEl = e.currentTarget;
      createDragLine();

      window.addEventListener('touchmove', dragMove, { passive: false });
      window.addEventListener('touchend', dragEnd);
      window.addEventListener('mousemove', dragMove);
      window.addEventListener('mouseup', dragEnd);
    }

    function dragMove(e) {
      const touch = e.touches ? e.touches[0] : e;
      const x = touch.clientX;
      const y = touch.clientY;

      const fromRect = startEl.getBoundingClientRect();
      const startX = fromRect.left + fromRect.width / 2;
      const startY = fromRect.top + fromRect.height / 2;

      const dx = x - startX;
      const dy = y - startY;
      const length = Math.hypot(dx, dy);
      const angle = Math.atan2(dy, dx) * (180 / Math.PI);

      dragLine.style.width = `${length}px`;
      dragLine.style.left = `${startX - gameArea.getBoundingClientRect().left}px`;
      dragLine.style.top = `${startY - gameArea.getBoundingClientRect().top}px`;
      dragLine.style.transform = `rotate(${angle}deg)`;
    }

    function dragEnd(e) {
      const touch = e.changedTouches ? e.changedTouches[0] : e;
      const x = touch.clientX;
      const y = touch.clientY;
      const dropTarget = document.elementFromPoint(x, y);

      window.removeEventListener('touchmove', dragMove);
      window.removeEventListener('touchend', dragEnd);
      window.removeEventListener('mousemove', dragMove);
      window.removeEventListener('mouseup', dragEnd);

      if (dropTarget && dropTarget.classList.contains('target')) {
        const fromId = startEl.dataset.id;
        const toId = dropTarget.dataset.id;

        if (fromId === toId) {
          fixLine(dragLine);
          startEl.removeEventListener('touchstart', dragStart);
          startEl.removeEventListener('mousedown', dragStart);
          dropTarget.classList.remove('target');
          messageBox.textContent = '잘했어요! 🎉';
          correctCount++;

          if (correctCount === 3) {
            setTimeout(() => {
              currentStage++;
              loadStage(currentStage);
            }, 1000);
          }
        } else {
          messageBox.textContent = '다시 시도해볼까? 💪';
          dragLine.remove();
        }
      } else {
        dragLine.remove();
      }

      startEl = null;
    }

    function createDragLine() {
      dragLine = document.createElement('div');
      dragLine.className = 'line';
      gameArea.appendChild(dragLine);
    }

    function fixLine(line) {
      line.style.transition = 'width 0.3s ease';
    }

    loadStage(currentStage);
  </script>
</body>
</html>
